/*!
 * what3words autosuggest jQuery plugin
 * Copyright (C) 2017 what3words Limited
 * Licensed under the MIT license
 *
 * @author what3words
 * @version 1.4.0
 * @link https://github.com/what3words/jquery-plugin-w3w-autosuggest
 */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(n),n}:t(jQuery)}(function(t){"use strict";var e=function(e,n){this._api_end_point="https://api.what3words.com/v2/",this.element=e,this._name="w3wAddress",this._defaults=t.fn.w3wAddress.defaults,this.options=t.extend({},this._defaults,n),this.init()};t.extend(e.prototype,{init:function(){this.buildWrappers(),this.autoSuggest(),this.validation()},destroy:function(){this.unbindEvents(),this.$element.removeData()},buildWrappers:function(){var e=this.options.direction;t(this.element).wrapAll('<div class="typeahead__container '+e+'"><div class="typeahead__field"><span class="typeahead__query"></span></div></div>'),this.options.logo&&(t(this.element).addClass("typeahead__padlogo"),t(this.element).closest(".typeahead__container").prepend('<img class="typeahead__w3w-logo" src="https://assets.what3words.com/images/w3w_grid-logo.svg" alt="w3w-logo">')),this.options.validation&&t(this.element).closest(".typeahead__container").after('<div class="typeahead__w3w_validation"></div>'),t(this.element).addClass("typeahead__w3w_valid").attr("placeholder",this.options.placeholder+" ").attr("autocomplete","off").attr("dir","auto").attr("aria-invalid","true")},bindEvents:function(){},unbindEvents:function(){this.$element.off("."+this._name)},callback:function(){var t=this.options.onComplete;"function"==typeof t&&t.call(this.element)},autoSuggest:function(){var e=/^(\D{1,})\.(\D{1,})\.(\D{1,})$/i;""===this.options.key&&this.options.debug?(console.log("No what3words API key found!"),alert("A what3words API key is required to use the AutoSuggest plugin. Information on how to register for a key can be found in the README")):this.options.debug&&console.log("what3words API key: "+this.options.key),"ar"===this.options.lang&&(t(this.element).css("direction","rtl"),this.options.hint=!1);var n,o=this,i=0;t.typeahead({debug:this.options.debug,input:t(this.element),minLength:5,compression:!0,hint:this.options.hint,emptyTemplate:!1,dynamic:!0,delay:this.options.typeaheadDelay,maxItem:20,source:{autosuggest:{filter:function(e,n){var a=null;return null!==o.options.country_filter&&(t(o.options.country_filter).get(0)?(a=t(o.options.country_filter).val(),"string"==typeof(a="string"==typeof a?a.toLowerCase():null)&&2===a.length||(a=null)):"string"==typeof o.options.country_filter&&2===o.options.country_filter.length&&(a=o.options.country_filter.toLowerCase())),null!==a?(o.options.debug&&(console.log("w3wAddress country_filter: "),console.log(t(o.options.country_filter)),console.log("Selected Country is: "+a),console.log("#################################")),e.country===a&&(i<o.options.results&&(i++,!0))):i<o.options.results?(i++,!0):void 0},display:["words"],template:function(t,e){return['<div class="typeahead__list-inner">','<span class="typeahead__twa-flag w3w-flags-{{country}}">',"</span>",'<span class="typeahead__twa">{{words}}</span>',"<br>",'<span class="typeahead__info">',"{{place}}","</span>","</div>"].join("\n")},ajax:function(n){var i=n;if(0===i.indexOf("///")&&(i=i.replace(/\/\/\//,"")),null!==e.exec(i)){t(o.element).trigger("searched",[n]);var a={addr:i,format:"json",key:o.options.key,count:o.options.count,display:"full"};void 0!==o.options.lang&&o.options.lang&&(a.lang=o.options.lang),void 0!==o.options.focus&&o.options.focus&&(a.focus=o.options.focus),void 0!==o.options.clip&&o.options.clip&&(a.clip=o.options.clip),o.options.multilingual||void 0!==a.lang||(a.lang="en");var s=o.options.multilingual?"autosuggest-ml":"autosuggest";return{type:"GET",url:o._api_end_point+s,data:a,path:"suggestions"}}return!1}}},callback:{onSearch:function(e,n){i=0,t(o.element).attr("aria-invalid",!0)},onInit:function(t){o.options.debug&&console.log("w3wAddress typeahead initiated on field: "+t.selector)},onResult:function(t,e,n,i){if(""!==e){var a="";0===n.length?a='No results matching "'+e+'"':n.length>0&&n.length<i?a="Showing "+n.length+" of "+i+' elements matching "'+e+'"':n.length>0&&(a="Showing "+n.length+" elements matching addr= "+e+'"'),a+=", with lang="+o.options.lang,void 0!==o.options.focus?a+=", with focus="+o.options.focus:a+=", without focus",o.options.debug&&console.log(a)}},onNavigateAfter:function(e,n,i,a,s,l){void 0===a||void 0===a.words?t(o.element).attr("aria-invalid",!0):t(o.element).attr("aria-invalid",!1)},onClickAfter:function(e,i,a,s){if(o.options.validation){var l=t(o.element).closest("form");if(l.length&&l.length>0){l.validate().element(".typeahead__w3w_valid"),t(o.element).closest(".typeahead__container").nextAll(".typeahead__w3w_validation").empty(),t(o.element).closest(".typeahead__query").hasClass("valid")||t(o.element).closest(".typeahead__query").addClass("valid"),clearTimeout(n);var r=function(){t(o.element).closest(".typeahead__query").removeClass("valid")};n=setTimeout(r,500)}}void 0===a||void 0===a.words?t(o.element).attr("aria-invalid",!0):(t(o.element).attr("aria-invalid",!1),void 0!==a&&t(o.element).trigger("selection",[a]))},onCancel:function(e,n){o.options.validation&&t(o.element).closest(".typeahead__container").nextAll(".typeahead__w3w_validation").empty(),t(o.element).attr("aria-invalid",!0),t(o.element).trigger("cancel")}}})},validation:function(){if(!1!==this.options.validation){this.options.debug&&console.log("Validating the w3wAddress field");var e=this;t.validator.addMethod("w3w_valid",function(n,o){if(this.optional(o)||""===n.replace(/ /g,""))return!0;var i=!1;if(null!==/^(\D{3,})\.(\D{3,})\.(\D{3,})$/i.exec(n)){var a=t(o).closest(".typeahead__container").find("span.typeahead__twa");if(void 0!==a&&a.length>0)for(var s=0;s<a.length&&!i;s++)a[s].innerText===n&&(i=!0);i||t.ajax({url:e._api_end_point+"forward",type:"GET",data:{addr:n,key:e.options.key,format:"json"},dataType:"json",success:function(t){t.hasOwnProperty("geometry")&&(i=!0)}})}return i},function(){return e.options.valid_error}),t.validator.addClassRules("typeahead__w3w_valid",{w3w_valid:!0});var n,o=/^(\D{1,})\.(\D{1,})\.(\D{1,})$/i,i=t(this.element).closest("form");i.length&&i.length>0&&i.validate({onfocusout:!1,onkeyup:function(e){if(t(e).hasClass("typeahead__w3w_valid")){clearTimeout(n);var i=function(){t(e).closest(".typeahead__query").removeClass("valid"),o.test(t(e).val())&&t(e).valid()};n=setTimeout(i,500)}},errorPlacement:function(t,e){var n=e.closest(".typeahead__container");t.appendTo(n.siblings(".typeahead__w3w_validation"))}})}}}),t.fn.w3wAddress=function(n){return this.each(function(){t.data(this,"plugin_w3wAddress")||t.data(this,"plugin_w3wAddress",new e(this,n))}),this},t.fn.w3wAddress.defaults={country_filter:null,key:"",debug:!1,hint:!1,count:50,results:3,logo:!0,lang:"en",focus:null,clip:null,multilingual:!0,direction:"ltr",placeholder:"e.g. lock.spout.radar",validation:!0,valid_error:"Please enter a valid 3 word address.",typeaheadDelay:100}});
//# sourceMappingURL=jquery.w3w-autosuggest-plugin.min.js.map

/*!
 * what3words autosuggest jQuery plugin
 * Copyright (C) 2017 what3words Limited
 * Licensed under the MIT license
 *
 * @author what3words
 * @version 1.5.5
 * @link https://github.com/what3words/jquery-plugin-w3w-autosuggest
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,i){return void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(i),i}:e(jQuery)}(function(e){"use strict";var t,i,n=/^[^0-9`~!@#$%^&*()+\-_=[{\]}\\|'<,.>?\/";:£§º©®\s]{1,}[・.][^0-9`~!@#$%^&*()+\-_=[{\]}\\|'<,.>?\/";:£§º©®\s]{1,}[・.][^0-9`~!@#$%^&*()+\-_=[{\]}\\|'<,.>?\/";:£§º©®\s]{1,}$/i,o=/^[^0-9`~!@#$%^&*()+\-_=[{\]}\\|'<,.>?\/";:£§º©®\s]{2,}[・.][^0-9`~!@#$%^&*()+\-_=[{\]}\\|'<,.>?\/";:£§º©®\s]{2,}[・.][^0-9`~!@#$%^&*()+\-_=[{\]}\\|'<,.>?\/";:£§º©®\s]{2,}$/i,a=function(t,i){this._api_end_point="https://api.what3words.com/v2/",this.element=t,this._name="w3wAddress",this._defaults=e.fn.w3wAddress.defaults,this.options=e.extend({},this._defaults,i),void 0!==this.options.api_end_point&&(this._api_end_point=this.options.api_end_point),this.init()},s=!1;e.extend(a.prototype,{init:function(){this.buildWrappers(),this.autoSuggest(),this.validation()},destroy:function(){this.unbindEvents(),this.$element.removeData()},buildWrappers:function(){var t=this.options.direction;if(e(this.element).wrapAll('<div class="typeahead__container '+t+'"><div class="typeahead__field"><span class="typeahead__query"></span></div></div>'),this.options.logo){e(this.element).addClass("typeahead__padlogo");e(this.element).closest(".typeahead__container").prepend('<svg class="typeahead__w3w-logo" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 32 32" xml:space="preserve"><path fill="currentColor" d="M10.7,4h2L4,28H2L10.7,4z M19.7,4h2L13,28h-2L19.7,4z M28.7,4h2L22,28h-2L28.7,4z"></path></svg>')}this.options.validation&&e(this.element).closest(".typeahead__container").after('<div class="typeahead__w3w_validation"></div>'),e(this.element).addClass("typeahead__w3w_valid").attr("placeholder",this.options.placeholder+" ").attr("autocomplete","off").attr("dir","auto").attr("aria-invalid","true")},bindEvents:function(){},unbindEvents:function(){this.$element.off("."+this._name)},callback:function(){var e=this.options.onComplete;"function"==typeof e&&e.call(this.element)},autoSuggest:function(){""===this.options.key||null===this.options.key?(console.log("No what3words API key found in constructor!"),void 0===this.options.api_end_point&&console.log("A what3words API key is required to use the AutoSuggest plugin. Information on how to register for a key can be found in the README")):this.options.debug&&console.log("what3words API key: "+this.options.key),"ar"===this.options.lang&&(e(this.element).css("direction","rtl"),this.options.hint=!1);var t,i=this,o=0;e(this.element).focusout(function(){if(/ /.test(this.value))if(this.value=this.value.replace(/ /g,""),i.options.validation){var t=e(i.element).closest("form");t.length&&t.length>0&&t.validate().element(".typeahead__w3w_valid")}else{var n=!1,o=e(i.element).closest(".typeahead__container").find("span.typeahead__twa");if(void 0!==o&&o.length>0)for(var a=0;a<o.length&&!n;a++)o[a].innerText===this.value&&(n=!0,e(i.element).attr("aria-invalid",!1))}}),e.typeahead({debug:this.options.debug,input:e(this.element),minLength:5,compression:!0,hint:this.options.hint,emptyTemplate:!1,dynamic:!0,delay:this.options.typeaheadDelay,maxItem:20,source:{autosuggest:{filter:function(t,n){var a=null;return null!==i.options.country_filter&&(e(i.options.country_filter).get(0)?(a=e(i.options.country_filter).val(),"string"==typeof(a="string"==typeof a?a.toLowerCase():null)&&2===a.length||(a=null)):"string"==typeof i.options.country_filter&&2===i.options.country_filter.length&&(a=i.options.country_filter.toLowerCase())),null!==a?(i.options.debug&&(console.log("w3wAddress country_filter: "),console.log(e(i.options.country_filter)),console.log("Selected Country is: "+a),console.log("#################################")),t.country===a&&(o<i.options.results&&(o++,!0))):o<i.options.results?(o++,!0):void 0},display:["words"],template:function(e,t){return['<div class="typeahead__list-inner">','<svg class="typeahead__w3w-logo-inline" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 32 32" xml:space="preserve"><path fill="currentColor" d="M10.7,4h2L4,28H2L10.7,4z M19.7,4h2L13,28h-2L19.7,4z M28.7,4h2L22,28h-2L28.7,4z"></path></svg>','<div class="typeahead__twa-flag w3w-flags-{{country}}"></div>','<div class="typeahead__twa">{{words}}</div>','<div class="typeahead__info">{{place}}</div>',"</div>"].join("\n")},ajax:function(t){var o=t;if(0===o.indexOf("///")&&(o=o.replace(/\/\/\//,"")),null!==n.exec(o)){e(i.element).trigger("searched",[t]);var a={addr:o,format:"json",key:i.options.key,count:i.options.count,display:"full"};void 0!==i.options.lang&&i.options.lang&&(a.lang=i.options.lang),void 0!==i.options.focus&&i.options.focus&&(a.focus=i.options.focus),void 0!==i.options.clip&&i.options.clip&&(a.clip=i.options.clip),i.options.multilingual||void 0!==a.lang||(a.lang="en");var s=i.options.multilingual?"autosuggest-ml":"autosuggest";return{type:"GET",url:i._api_end_point+s,data:a,path:"suggestions"}}return!1}}},callback:{onSearch:function(t,n){o=0,e(i.element).attr("aria-invalid",!0)},onInit:function(e){i.options.debug&&console.log("w3wAddress typeahead initiated on field: "+e.selector)},onResult:function(e,t,n,o){if(""!==t){var a="";0===n.length?a='No results matching "'+t+'"':n.length>0&&n.length<o?a="Showing "+n.length+" of "+o+' elements matching "'+t+'"':n.length>0&&(a="Showing "+n.length+" elements matching addr= "+t+'"'),a+=", with lang="+i.options.lang,void 0!==i.options.focus?a+=", with focus="+i.options.focus:a+=", without focus",i.options.debug&&console.log(a)}},onNavigateAfter:function(t,n,o,a,s,l){console.log(a),void 0===a||void 0===a.words?e(i.element).attr("aria-invalid",!0):e(i.element).attr("aria-invalid",!1)},onClickAfter:function(n,o,a,l){if(i.options.validation){var r=e(i.element).closest("form");if(r.length&&r.length>0){r.validate().element(".typeahead__w3w_valid"),e(i.element).closest(".typeahead__container").nextAll(".typeahead__w3w_validation").empty(),e(i.element).closest(".typeahead__query").hasClass("valid")||e(i.element).closest(".typeahead__query").addClass("valid"),clearTimeout(t);var d=function(){e(i.element).closest(".typeahead__query").removeClass("valid")};t=setTimeout(d,500)}}void 0===a||void 0===a.words?e(i.element).attr("aria-invalid",!0):(e(i.element).attr("aria-invalid",!1),void 0!==a&&setTimeout(function(){s=!0,e(i.element).valid(),e(i.element).trigger("blur")},300))},onHideLayout:function(t,n){s=!0,e(i.element).valid()},onCancel:function(t,n){i.options.validation&&e(i.element).closest(".typeahead__container").nextAll(".typeahead__w3w_validation").empty(),e(i.element).attr("aria-invalid",!0),e(i.element).removeClass("valid"),e(i.element).trigger("cancel")}}})},validation:function(){if(!1!==this.options.validation){this.options.debug&&console.log("Validating the w3wAddress field");var a=this;e.validator.addMethod("w3w_valid",function(n,l){if(this.optional(l)||""===n.replace(/ /g,""))return!0;var r=!1,d=n;if(/ /.test(d)&&(d=n.replace(/ /g,""),e(l).val(d)),null!==o.exec(d)){var p=e(l).closest(".typeahead__container").find("span.typeahead__twa");if(void 0!==p&&p.length>0)for(var u=0;u<p.length&&!r;u++)p[u].innerText===d&&(r=!0);d===t&&(r=i),s&&(d!==t?(e.ajax({url:a._api_end_point+"forward",type:"GET",async:!1,data:{addr:d,key:a.options.key,format:"json"},dataType:"json",success:function(e){e.hasOwnProperty("geometry")&&(r=!0)}}),t=d,i=r):r=i,s=!1)}return console.log("validate",s,r),r},function(){return a.options.valid_error}),e.validator.addClassRules("typeahead__w3w_valid",{w3w_valid:!0});var l,r=e(this.element).closest("form");r.length&&r.length>0&&r.validate({onfocusout:function(t){s=!0,e(t).valid()},onkeyup:function(t){if(e(t).hasClass("typeahead__w3w_valid")){clearTimeout(l);var i=function(){e(t).closest(".typeahead__query").removeClass("valid");const i=e(t).val();"///"===i.substr(0,3)&&e(t).val(i.substring(3)),n.test(e(t).val())&&e(t).valid()};l=setTimeout(i,500)}},errorPlacement:function(e,t){var i=t.closest(".typeahead__container");e.appendTo(i.siblings(".typeahead__w3w_validation"))}})}}}),e.fn.w3wAddress=function(t){return this.each(function(){e.data(this,"plugin_w3wAddress")||e.data(this,"plugin_w3wAddress",new a(this,t))}),this},e.fn.w3wAddress.defaults={country_filter:null,key:"",debug:!1,hint:!1,count:50,results:3,logo:!0,lang:"en",focus:null,clip:null,multilingual:!0,direction:"ltr",placeholder:"e.g. lock.spout.radar",validation:!0,valid_error:"Please enter a valid 3 word address.",typeaheadDelay:100}});
//# sourceMappingURL=jquery.w3w-autosuggest-plugin.min.js.map
